<html>
<head>
<style>
#info {
    position: absolute;
    top: 0px;
    width: 100%;
    padding: 10px;
    text-align: center;
    color: #ffff00
}

body {
    overflow: hidden;
}
</style>
</head>
<body>
<div id="info">hw1
    <br/>Xmas Lights with HTML & CSS & JavaScript<br/>
    <button id="toggle">toggle0</button>
	<button id="resetPOS">resetPOS</button>
    <div id="light0" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light1" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light2" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light3" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light4" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light5" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light6" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light7" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light8" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light9" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light10" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light11" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light12" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light13" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light14" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light15" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light16" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light17" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light18" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light19" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light20" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light21" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light22" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light23" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light24" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light25" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light26" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light27" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light28" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light29" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light30" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light31" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light32" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light33" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light34" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light35" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light36" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light37" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light38" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light39" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
	<div id="light40" style = "background-Color: hsl(0,5%,50%); width:20px; height:20px; border-radius:50%;"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>
var camera, scene, renderer, controls, lightA = 0, lightmesh2, tree, light = [], lamp = [], state = 0;

$('#resetPOS').click( function() {
	for(let i = 0; i < 41; i++) {
		lamp[i].position(Math.floor(Math.random() * 80) + 10, Math.floor(Math.random() * 80) + 10);
	}
});

$('#toggle').click( function() {
	state = (state+1)%3;
    $('#toggle').text("toggle" + state);
    if(state === 2) {
    	for(let i = 0; i < 55; i++) {
        	toggleBlink2(i);
            light[i].turn = true;
            light[i].toggle();
        }
    	for(let i = 0; i < 55; i+=2) light[i].turn = true;
    	for(let i = 0; i < 55; i++) toggleBlink1(i,Math.floor(Math.random() * 2000) + 500);
		for(let i = 0; i < 41; i++) lamp[i].toggleBlink2();
		for(let i = 0; i < 41; i+=2) lamp[i].turnon();
		for(let i = 0; i < 41; i++) lamp[i].toggleBlink1(Math.floor(Math.random() * 2000) + 500);
    }
    else if(state === 1) {
    	for(let i = 0; i < 55; i+=2) light[i].turn = true;
    	for(let i = 0; i < 55; i++) toggleBlink1(i,500);
		for(let i = 0; i < 41; i+=2) lamp[i].turnon();
		for(let i = 0; i < 41; i++) lamp[i].toggleBlink1(500);
    }
    else if(state === 0) {
    	for(let i = 0; i < 55; i++) {
        	toggleBlink2(i);
            light[i].turn = true;
            light[i].toggle();
			for(let i = 0; i < 41; i++) lamp[i].toggleBlink2();
        }
    }
});

function Lamp(lampId) {
  var name = '#' + lampId;
  var status = false;
  var interval;

  var toggle = function() {
    status = !status;
    
    if (status) {
    	var str = "hsl(" + Math.floor(Math.random() * 360) + ",100%,50%)";
    	$(name).css ('backgroundColor', str);
    } else {
    	$(name).css ('backgroundColor', 'rgb(64,64,128)');
    }
  };
  
  this.position = function(h,w) {
	$(name).css ('position', 'absolute');
	$(name).css ('top', '' + h + 'vh');
	$(name).css ('left', '' + w + 'vw');
  }

  this.check = function() {
    return status;
  }
  
  this.toggleBlink1 = function(time) {
  	interval = setInterval (function() {toggle();}, time);
  }
  
  this.toggleBlink2 = function(time) {
  	clearInterval(interval);
	$(name).css ('backgroundColor', 'rgb(64,64,128)');
	status = false;
  }
  
  this.turnon = function() {
	var str = "hsl(" + Math.floor(Math.random() * 360) + ",100%,50%)";
    $(name).css ('backgroundColor', str);
	status = true;
  }
}

class XmasLight {
	constructor(x,y,z) {
    	let color = new THREE.Color();
        color.setHSL(Math.floor(Math.random() * 16777215) / 16777215, 1, 0.5);
        
    	this.mesh1 = new THREE.Mesh( new THREE.OctahedronBufferGeometry( 7, 3), new THREE.MeshBasicMaterial({color: color}));
        this.mesh1.position.set(x,y,z);
        this.mesh1.visible = false;
        scene.add(this.mesh1);
        
        this.mesh2 = new THREE.Mesh( new THREE.OctahedronBufferGeometry( 7, 3), new THREE.MeshBasicMaterial({color: 0x555555}));
        this.mesh2.position.set(x,y,z);
        scene.add(this.mesh2);
        
        this.light = new THREE.PointLight(color, 1, 100);
    	this.light.position.set(x,y,z);
        this.light.visible = false;
    	scene.add(this.light);
        
        this.turn = false;
        this.interval;
    }
    
    toggle() {
    	this.turn = !this.turn;
        if(this.turn === true) {
        	this.mesh1.visible = true;
            this.mesh2.visible = false;
            this.light.visible = true;
        }
        else {
        	this.mesh1.visible = false;
            this.mesh2.visible = true;
            this.light.visible = false;
        }
    }
}

function build_light() {
	let r = 95, h = 40;
	for(let i = 0; i < 55; i++, h += 2, r -= 1.2) {
    	light[i] = new XmasLight( Math.cos((i/3)%(Math.PI*2)) * r, h, Math.sin((i/3)%(Math.PI*2)) * r);
    }
}

function toggleBlink1(i,time) {
	light[i].interval = setInterval (function() {light[i].toggle();}, time);
}

function toggleBlink2(i) {
  	clearInterval(light[i].interval);
}

function setLamp() {
	for(let i = 0; i < 41; i++) {
		lamp[i] = new Lamp("light" + i);
		lamp[i].position(Math.floor(Math.random() * 80) + 10, Math.floor(Math.random() * 80) + 10);
	}
}

function build_leaves( h, color) {
	let obj = new THREE.Object3D();
    
    let mesh1 = new THREE.Mesh(new THREE.CylinderBufferGeometry( 1, h/3, h, 3), new THREE.MeshLambertMaterial({
        color: color
    }));
    mesh1.rotation.x = -Math.PI/1.8;
    mesh1.position.z = -h/2;
    
    let mesh2 = new THREE.Object3D();
    mesh2.add(mesh1.clone());
    
    for(let i = 0; i < 12; i++) {
    	let leaf = mesh2.clone();
    	leaf.rotation.y = Math.PI * i / 6;
    	obj.add(leaf);
    }
    
    return obj;
}

function build_XmasTree() {
    let obj = new THREE.Object3D();

    let mesh1 = new THREE.Mesh(new THREE.CylinderBufferGeometry( 32, 40, 4, 6), new THREE.MeshLambertMaterial({
        color: 0x705436
    }));
    mesh1.position.y = 2;
    mesh1.rotation.y = Math.PI/6;
    obj.add(mesh1);
    
    let mesh2 = new THREE.Mesh(new THREE.CylinderBufferGeometry( 12, 20, 40, 6), new THREE.MeshLambertMaterial({
        color: 0x9e764a
    }));
    mesh2.position.y = 24;
    mesh2.rotation.y = Math.PI/6;
    obj.add(mesh2);
    
    let mesh3 = build_leaves( 100, 0x286022);
    mesh3.position.y = 40;
    obj.add(mesh3);
    
    let mesh35 = build_leaves( 92, 0x2D6E26);
    mesh35.position.y = 55;
    mesh35.rotation.y = Math.PI/12;
    obj.add(mesh35);
    
    let mesh4 = build_leaves( 85, 0x337c2b);
    mesh4.position.y = 70;
    obj.add(mesh4);
    
    let mesh45 = build_leaves( 77, 0x398A30);
    mesh45.position.y = 85;
    mesh45.rotation.y = Math.PI/12;
    obj.add(mesh45);
    
    let mesh5 = build_leaves( 70, 0x3f9935);
    mesh5.position.y = 100;
    obj.add(mesh5);
    
    let mesh55 = build_leaves( 62, 0x419938);
    mesh55.position.y = 115;
	mesh55.rotation.y = Math.PI/12;
    obj.add(mesh55);
    
    let mesh6 = build_leaves( 55, 0x43993b);
    mesh6.position.y = 130;
    obj.add(mesh6);
    
    let star = new THREE.Object3D();
    
    let starmesh =  new THREE.Mesh(new THREE.CylinderBufferGeometry( 1, 4, 15, 4), new THREE.MeshLambertMaterial({
        color: 0xf4f11a
    }));
    starmesh.position.y = 7.5;
    let starobj = new THREE.Object3D();
    starobj.add(starmesh);
    
    let mesh7 =  new THREE.Mesh(new THREE.CylinderBufferGeometry( 1, 4, 10, 8), new THREE.MeshLambertMaterial({
        color: 0xf4f11a
    }));
    star.add(mesh7);
    
    let mesh8 =  starobj.clone();
    mesh8.position.y = 8;
    star.add(mesh8);
    
    let mesh9 =  starobj.clone();
    mesh9.rotation.z = Math.PI/2.5;
    mesh9.position.y = 8;
    star.add(mesh9);
    
    let mesh10 =  starobj.clone();
    mesh10.rotation.z = Math.PI*2/2.5;
    mesh10.position.y = 8;
    star.add(mesh10);
    
    let mesh11 =  starobj.clone();
    mesh11.rotation.z = Math.PI*3/2.5;
    mesh11.position.y = 8;
    star.add(mesh11);
    
    let mesh12 =  starobj.clone();
    mesh12.rotation.z = Math.PI*4/2.5;
    mesh12.position.y = 8;
    star.add(mesh12);
    
    star.position.y = 157;
    obj.add(star);

	let mesh13 = new THREE.Mesh( new THREE.OctahedronBufferGeometry( 130, 3), new THREE.MeshLambertMaterial({
        color: 0x8888ff,
        transparent: true,
        opacity: 0.3
    }));
    mesh13.position.y = 100;
    obj.add(mesh13);
    
    let mesh14 =  new THREE.Mesh(new THREE.CylinderBufferGeometry( 70, 80, 20, 8), new THREE.MeshLambertMaterial({
        color: 0xff130f
    }));
    mesh14.position.y = -20;
    obj.add(mesh14);
    
    let mesh15 =  new THREE.Mesh(new THREE.CylinderBufferGeometry( 80, 70, 10, 8), new THREE.MeshLambertMaterial({
        color: 0xffffff
    }));
    mesh15.position.y = -5;
    obj.add(mesh15);
    return obj;
}

init();
animate();

function init() {
    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
    camera.position.set( 0, 250, 300);
    scene.add(camera);

    var gridXZ = new THREE.GridHelper(400, 40, 'red', 'white');
    //scene.add(gridXZ);

    renderer = new THREE.WebGLRenderer({
        antialias: true
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0x222255);

    controls = new THREE.OrbitControls(camera, renderer.domElement);

    document.body.appendChild(renderer.domElement);
    ////////////////////////////////////////////////////////////////////////
    var lightmesh = new THREE.AmbientLight(0x888888);
    scene.add(lightmesh);
    lightmesh2 = new THREE.PointLight(0xaaaaaa, 1.5, 1000);
    lightmesh2.position.set( 200, 500, 200);
    scene.add(lightmesh2);

    tree = build_XmasTree();
    scene.add(tree);
    
    build_light();
    setLamp();
}

function animate() {
    controls.update();
    camera.lookAt(new THREE.Vector3( 0, 100, 0));
    //lightA = (lightA + 0.005) % (Math.PI * 2);
    //lightmesh2.position.set( Math.cos(lightA) * 200, 200, Math.sin(lightA) * 200);

    requestAnimationFrame(animate);
    renderer.render(scene, camera);
}
</script>
</body>
</html>